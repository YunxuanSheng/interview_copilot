# 音频转文字功能设置指南

## 环境变量配置

在项目根目录创建 `.env.local` 文件，并添加以下配置：

```bash
# 数据库配置
DATABASE_URL="file:./dev.db"

# NextAuth配置
NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET="your-secret-key-here"

# OpenAI配置（用于语音转文字）
OPENAI_API_KEY="your-openai-api-key-here"

# 其他配置
NODE_ENV="development"
```

## 获取OpenAI API密钥

1. 访问 [OpenAI Platform](https://platform.openai.com/)
2. 注册或登录账户
3. 进入 API Keys 页面
4. 创建新的API密钥
5. 将密钥复制到 `.env.local` 文件中的 `OPENAI_API_KEY` 字段

## 功能说明

### 支持的音频格式
- MP3 (.mp3)
- WAV (.wav)
- M4A (.m4a)
- OGG (.ogg)

### 文件大小限制
- **实际限制**：25MB（OpenAI Whisper API限制）
- **最大上传**：100MB（超过25MB会提示优化建议）
- **推荐大小**：< 25MB（最佳处理效果）
- **长录音建议**：分段处理或压缩后上传

### 使用方法

1. **在面试复盘页面使用**：
   - 访问 `/interviews/new`
   - 上传音频文件
   - 点击"语音转文字"按钮
   - 等待处理完成

2. **测试页面**：
   - 访问 `/test-audio`
   - 上传音频文件进行测试

### 技术实现

- 使用 OpenAI Whisper API 进行语音转文字
- 支持中文语音识别
- **智能对话人识别**：自动区分面试官和候选人
- **长录音支持**：支持最长2小时的面试录音
- **分段处理**：自动处理长录音，确保稳定性
- 自动降级到模拟数据（如果API不可用）
- 文件类型和大小验证

### 新增功能

#### 对话人识别
- 自动识别面试官和候选人的发言
- 基于AI分析对话模式，准确区分说话人
- 转录结果包含说话人标签和时间戳
- 可视化显示不同说话人的发言内容

#### 长录音处理建议
- **文件压缩**：使用音频编辑软件压缩到25MB以下
- **分段上传**：将长录音分割成15-20分钟的片段
- **格式优化**：使用MP3 128kbps格式减少文件大小
- **在线工具**：使用在线音频分割工具预处理

#### 实际处理能力
- **25MB以下**：直接处理，最佳效果
- **25-100MB**：提示优化建议，可能处理失败
- **超过100MB**：拒绝上传，建议分段处理

### 故障排除

1. **API密钥错误**：
   - 检查 `.env.local` 文件中的 `OPENAI_API_KEY` 是否正确
   - 确保API密钥有足够的额度

2. **文件上传失败**：
   - 检查文件格式是否支持
   - 检查文件大小是否超过限制

3. **转文字失败**：
   - 检查网络连接
   - 查看浏览器控制台错误信息
   - 系统会自动降级到模拟数据

### 长录音处理指南

#### 方法一：音频压缩（推荐）
1. 使用 Audacity（免费）或 Adobe Audition
2. 导出为 MP3 格式，比特率设置为 128kbps
3. 通常可以将文件大小减少 60-80%

#### 方法二：分段处理
1. 使用音频编辑软件将录音分割成 15-20 分钟片段
2. 分别上传每个片段进行转录
3. 在面试记录中手动合并结果

#### 方法三：在线工具
- [Audio Trimmer](https://audiotrimmer.com/) - 在线音频分割
- [MP3 Compressor](https://www.mp3compressor.com/) - 在线音频压缩
- [CloudConvert](https://cloudconvert.com/) - 格式转换和压缩

### 成本说明

- OpenAI Whisper API 按使用量计费
- 建议先使用测试页面验证功能
- 可以设置使用限制来控制成本
- 长录音建议压缩后上传以节省成本
